NNLOJET
=======

NNLOJET is a multipurpose parton-level Monte Carlo generator which can compute several different process at NNLO in QCD using the antenna subtraction method.
While at the moment the code is private, ``pinefarm`` provides an interface to autogenerate ``pinecards`` from NNPDF datasets and NNLOJET runcards from pinefarm ``pinecards``.

The installation of NNLOJET is *not* automatized by ``pinefarm`` as it won't be run by ``pinefarm`` which will only prepare the runcards.
Please follow the `installation instructions <https://nnlojet.hepforge.org/manual3.html>`_.

Generating a pinecard
---------------------

Pinecards for NNLOJET are a declarative ``.yaml`` representation of NNLOJET ``.run`` runcards.
These can be mostly autogenerated using the ``autogen`` command

::

   pinefarm autogen <dataset name>


Where dataset name is one of the datasets from NNPDF, e.g., ``LHCB_Z0_8TEV_MUON_Y``.
This will generate a new folder with a template in the ``paths::pinecards`` folder (as defined in the ``pinefarm.toml`` file), named ``NNLOJET_<dataset name>``.

This folder contains two files, a ``.yaml`` file, which defines the run, and a ``metadata.txt`` file which ``pinefarm`` will use to add extra key-value pairs to the final grids.


Running with NNLOJET
--------------------

The most common use-case of NNLOJET is the generation of NNLO grids, for which running in a cluster is necessary.
Job management is beyond the scope of ``pinefarm`` and users are discouraged to run NNLOJET manually.
Instead, the official workflow must be used as described in the `NNLOJET documentation <https://nnlojet.hepforge.org/manual6.html>`_

In order to obtain a NNLOJET runcard that can be used together with the workflof, use:

::

    pinefarm run <pinecard name> <theory>


Where theory must be a yaml file defining the parameters of the theory, e.g., `this one <https://github.com/NNPDF/pinefarm/blob/main/extras/theories/theory_nnlo.yaml>`_.
This last will create a folder in the ``paths::results`` folder named ``<theory ID>_<dataset>_<timestamp>``.

In most cases (and all for which a ``postrun.sh`` is provided) it will be necessary to run
the finalize step `after` the NNLOJET calculation has finished.
For that add the ``--finalize`` flag, pointing to the appropriate run folder.

::

    pinefarm run <pinecard name> <theory> --finalize <runfolder>
